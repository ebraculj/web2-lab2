<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testiranje XSS napada</title>
</head>
<body>
    <h1>Testiranje sigurnosnih ranjivosti</h1>

    <section>
        <h2>XSS (Cross-site Scripting) prijetnja</h2>
        <h3>Opis rada sustava</h3>
        <p>Servis koji bez provjere ulaznih podataka(komentara) pohranjuje te iste komentare. Problem može nastati kada se kao komentar priloži
        JavaScript kod koji može doći do osjetljivih podataka o korisniku, kolačićima na stranici, sesiji i slično. Server ima dva načina funkcioniranja:
        kada je ranjivost isključena i kada je omogućena. Načini rada se reguliraju gumbom izbora(checkbox).
        </p>
        <br>
        <h3>Testiranje</h3>
        <p>Ukoliko je napad onemogućen komentar koji je unesen će se sanitizirati na način da će se svi "specijalni" znakovi pretvoriti u znak entitet 
            i u sadržaju stranice će se ispisati da je napad bio onemogućen i sanitizirani koemntar. Ako je napad omogućen neće se 
            razmatrati sadržaj komentara već će se on samo pohraniti, odnosno u slučaju malicioznog JavaScript koda izvršiti. U alert prozoru
            će se pojaviti podaci o korisničkom imenu i komentaru koji je unesen i time je narušena sigurnost servisa i iskorištena je ta ranjivost.
        </p>
        <br>
        <form id="xss">
            <label>Korisničko ime: </label>
            <input id="usernameInput" type="text" placeholder="Unesite korisničko ime">
            <br><br>
            <label>Komentar: </label>
            <input type="text" id="xssInput" placeholder="Unesite svoj komentar">
            <button type="submit">Pošaljite</button>
        </form>
        <br>
        <label>
            <input type="checkbox" id="XSSTrue"> Omogući XSS napad
        </label>
        <p id="xssOutput"></p>
    </section>

    <hr><hr>

    <section>
        <h2>Nesigurna pohrana osjetljivih podataka</h2>
        <h3>Opis rada sustava</h3>
        <p>
            
        </p>
    </section>

    <script>
        // XSS
        const enableXSSCheckbox = document.getElementById('XSSTrue');
        const xssForm = document.getElementById('xss');
        const xssInput = document.getElementById('xssInput');
        const xssOutput = document.getElementById('xssOutput');
        const usernameInput = document.getElementById("usernameInput");

        xssForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const inputValue = xssInput.value;
            //je li napad omogucen
            if (enableXSSCheckbox.checked) {
                // ako je, izvrsi 
                xssOutput.innerHTML = inputValue;  //prikazivanje komentara - moguce izvrsavanje
                const username = usernameInput.value;

                //alert s podacima
                alert("NAPADNUTI STE!\nXSS napad pokrenut!\n" +
                      "Korisničko ime: " + username + "\n" + 
                      "Komentar: " + inputValue);
            } else {
                //ako nije omogucen sanitiziraj i prikazi
                const sanitizedInput = sanitizeText(inputValue);
                xssOutput.innerText = "XSS napad nije moguć.\n Sanitizirani unos: " + sanitizedInput;
            }
        });

        //sanitizacija - zamjena spec znakova
        function sanitizeText(input) {
            return input.replace(/[&<>"'/]/g, function(match) {
                switch(match) {
                    case '&': return '&amp;';
                    case '<': return '&lt;';
                    case '>': return '&gt;';
                    case '"': return '&quot;';
                    case "'": return '&#39;';
                    case '/': return '&#47;';
                    default: return match;
                }
            });
        }
    </script>
</body>
</html>
